<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WorkFlow - Frontend &amp; Backend Communication Architecture</title>
<style>
  @page { size: A4; margin: 15mm; }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', 'Malgun Gothic', sans-serif; color: #1a1a2e; background: #fff; line-height: 1.6; padding: 20px; max-width: 1100px; margin: 0 auto; }

  /* Header */
  .header { text-align: center; padding: 40px 20px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); color: white; border-radius: 16px; margin-bottom: 32px; }
  .header h1 { font-size: 28px; margin-bottom: 8px; letter-spacing: -0.5px; }
  .header .subtitle { font-size: 15px; opacity: 0.85; }
  .header .date { font-size: 12px; opacity: 0.6; margin-top: 12px; }

  /* TOC */
  .toc { background: #f8f9fc; border-radius: 12px; padding: 24px 32px; margin-bottom: 32px; border-left: 4px solid #0f3460; }
  .toc h2 { font-size: 18px; margin-bottom: 12px; color: #0f3460; }
  .toc ol { padding-left: 20px; }
  .toc li { margin: 6px 0; font-size: 14px; }
  .toc a { color: #0f3460; text-decoration: none; }
  .toc a:hover { text-decoration: underline; }

  /* Section */
  .section { margin-bottom: 36px; page-break-inside: avoid; }
  .section h2 { font-size: 22px; color: #0f3460; border-bottom: 3px solid #e94560; padding-bottom: 8px; margin-bottom: 20px; }
  .section h3 { font-size: 17px; color: #16213e; margin: 16px 0 10px; padding-left: 12px; border-left: 3px solid #e94560; }
  .section p { font-size: 14px; margin-bottom: 10px; color: #333; }

  /* Diagram boxes */
  .diagram { background: #f0f2f8; border-radius: 12px; padding: 24px; margin: 16px 0; overflow-x: auto; }
  .diagram pre { font-family: 'Consolas', 'D2Coding', monospace; font-size: 12.5px; line-height: 1.5; color: #1a1a2e; white-space: pre; }

  /* Flow cards */
  .flow-container { display: flex; flex-direction: column; gap: 0; margin: 16px 0; }
  .flow-step { display: flex; align-items: stretch; gap: 0; }
  .flow-num { width: 48px; min-width: 48px; display: flex; flex-direction: column; align-items: center; }
  .flow-circle { width: 36px; height: 36px; border-radius: 50%; background: #0f3460; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; flex-shrink: 0; }
  .flow-line { flex: 1; width: 3px; background: #c5cae9; margin: 0 auto; }
  .flow-content { flex: 1; background: #fff; border: 1px solid #e0e3eb; border-radius: 10px; padding: 14px 18px; margin-bottom: 8px; }
  .flow-content .title { font-weight: 700; font-size: 14px; color: #0f3460; margin-bottom: 4px; }
  .flow-content .desc { font-size: 13px; color: #555; }
  .flow-content .tech { display: inline-block; background: #e8eaf6; color: #283593; font-size: 11px; padding: 2px 8px; border-radius: 4px; margin-top: 4px; }

  /* Tables */
  table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 13px; }
  th { background: #1a1a2e; color: white; padding: 10px 12px; text-align: left; font-weight: 600; }
  td { padding: 9px 12px; border-bottom: 1px solid #e8e8e8; }
  tr:nth-child(even) { background: #f8f9fc; }
  tr:hover { background: #eef0f7; }

  /* Info boxes */
  .info-box { background: #e8eaf6; border-left: 4px solid #3f51b5; border-radius: 8px; padding: 14px 18px; margin: 12px 0; font-size: 13px; }
  .warn-box { background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 8px; padding: 14px 18px; margin: 12px 0; font-size: 13px; }
  .success-box { background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 8px; padding: 14px 18px; margin: 12px 0; font-size: 13px; }

  /* Tags */
  .tag { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; margin: 2px; }
  .tag-blue { background: #e3f2fd; color: #1565c0; }
  .tag-green { background: #e8f5e9; color: #2e7d32; }
  .tag-red { background: #fce4ec; color: #c62828; }
  .tag-purple { background: #f3e5f5; color: #6a1b9a; }
  .tag-orange { background: #fff3e0; color: #e65100; }

  /* Grid */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 16px 0; }
  .card { background: #fff; border: 1px solid #e0e3eb; border-radius: 10px; padding: 16px; }
  .card h4 { font-size: 14px; color: #0f3460; margin-bottom: 8px; }
  .card p { font-size: 12px; color: #666; }
  .card-icon { font-size: 28px; margin-bottom: 8px; }

  /* Code */
  code { background: #f0f2f8; padding: 2px 6px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 12px; color: #c62828; }

  /* Arrow */
  .arrow-down { text-align: center; font-size: 24px; color: #9e9e9e; margin: 4px 0; }

  /* Print */
  @media print {
    body { padding: 0; }
    .header { page-break-after: avoid; }
    .section { page-break-inside: avoid; }
    .no-print { display: none; }
  }

  .btn-download { position: fixed; top: 20px; right: 20px; background: #e94560; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(233,69,96,0.3); z-index: 100; }
  .btn-download:hover { background: #d63851; }
</style>
</head>
<body>

<button class="btn-download no-print" onclick="window.print()">PDF ë‹¤ìš´ë¡œë“œ (Ctrl+P)</button>

<!-- ==================== HEADER ==================== -->
<div class="header">
  <h1>WorkFlow System Architecture</h1>
  <div class="subtitle">Frontend &amp; Backend Communication ì „ì²´ êµ¬ì¡°ë„</div>
  <div class="date">v1.17 | 2026-02-12 | attendance_go (ì¶œí‡´ê·¼GO)</div>
</div>

<!-- ==================== TOC ==================== -->
<div class="toc">
  <h2>ëª©ì°¨</h2>
  <ol>
    <li><a href="#s1">ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Big Picture)</a></li>
    <li><a href="#s2">ê¸°ìˆ  ìŠ¤íƒ êµ¬ì„±</a></li>
    <li><a href="#s3">Supabase ë°±ì—”ë“œ êµ¬ì¡° (DB + Auth + API + Edge Functions)</a></li>
    <li><a href="#s4">ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ &amp; í…Œì´ë¸” ê´€ê³„</a></li>
    <li><a href="#s5">API í†µì‹  ì›ë¦¬ (REST API + JWT)</a></li>
    <li><a href="#s6">ì¸ì¦(Auth) íë¦„ ìƒì„¸</a></li>
    <li><a href="#s7">í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœê´€ë¦¬ (Riverpod)</a></li>
    <li><a href="#s8">ì‹¤ì œ ë°ì´í„° íë¦„ ì˜ˆì‹œ (ì¶œê·¼~ëŒ€ì‹œë³´ë“œ)</a></li>
    <li><a href="#s9">ë³´ì•ˆ: RLS (Row Level Security)</a></li>
    <li><a href="#s10">ë°°í¬ êµ¬ì¡°</a></li>
    <li><a href="#s11">íŒŒì¼ êµ¬ì¡° ë ˆí¼ëŸ°ìŠ¤</a></li>
  </ol>
</div>

<!-- ==================== 1. BIG PICTURE ==================== -->
<div class="section" id="s1">
  <h2>1. ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Big Picture)</h2>
  <p>WorkFlowëŠ” <strong>ì„œë²„ë¦¬ìŠ¤(Serverless) ì•„í‚¤í…ì²˜</strong>ë¥¼ ì±„íƒí•©ë‹ˆë‹¤. ë³„ë„ì˜ WAS(Web Application Server)ë¥¼ ìš´ì˜í•˜ì§€ ì•Šê³ , Supabaseê°€ DB + Auth + API + Edge Functionsë¥¼ ëª¨ë‘ ì œê³µí•©ë‹ˆë‹¤.</p>

  <div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì (Users)                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  ê´€ë¦¬ì (PC)  â”‚          â”‚ ê·¼ë¡œì (Android) â”‚      â”‚ ê·¼ë¡œì (iOS)  â”‚   â”‚
â”‚    â”‚  Chrome ë¸Œë¼ìš°ì €â”‚         â”‚  Worker App   â”‚        â”‚  Worker App  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚                       â”‚
            â”‚  HTTPS                  â”‚  HTTPS                â”‚  HTTPS
            â”‚                         â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â–¼                         â–¼                       â–¼          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚              Supabase Cloud Platform                         â”‚     â”‚
â”‚   â”‚                                                              â”‚     â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚   â”‚  Auth       â”‚  â”‚  PostgREST  â”‚  â”‚   Edge Functions   â”‚  â”‚     â”‚
â”‚   â”‚   â”‚  (GoTrue)   â”‚  â”‚  (REST API) â”‚  â”‚   (Deno Runtime)   â”‚  â”‚     â”‚
â”‚   â”‚   â”‚             â”‚  â”‚             â”‚  â”‚                    â”‚  â”‚     â”‚
â”‚   â”‚   â”‚ - SMS OTP   â”‚  â”‚ - CRUD API  â”‚  â”‚ - calculate-payrollâ”‚  â”‚     â”‚
â”‚   â”‚   â”‚ - Email/PW  â”‚  â”‚ - ìë™ìƒì„±   â”‚  â”‚ - (í™•ì¥ ê°€ëŠ¥)      â”‚  â”‚     â”‚
â”‚   â”‚   â”‚ - JWT ë°œê¸‰  â”‚  â”‚ - RLS ì ìš©  â”‚  â”‚                    â”‚  â”‚     â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚          â”‚                â”‚                   â”‚              â”‚     â”‚
â”‚   â”‚          â–¼                â–¼                   â–¼              â”‚     â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚
â”‚   â”‚   â”‚           PostgreSQL Database                     â”‚      â”‚     â”‚
â”‚   â”‚   â”‚                                                  â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  [Tables]    [Triggers]      [RLS Policies]      â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  sites       work_hours      get_my_role()       â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  parts       updated_at      get_my_site_id()    â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  workers                                         â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  attendances                                     â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  payrolls                                        â”‚      â”‚     â”‚
â”‚   â”‚   â”‚  worker_profiles                                 â”‚      â”‚     â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Supabase Storage (íŒŒì¼ ì €ì¥, í–¥í›„ í”„ë¡œí•„ ì‚¬ì§„ ë“±)               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Supabase Realtime (ì‹¤ì‹œê°„ êµ¬ë…, í–¥í›„ ì•Œë¦¼ ë“±)                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë³„ë„ í˜¸ìŠ¤íŒ… í•„ìš”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì •ì  ì›¹ í˜¸ìŠ¤íŒ… (Vercel ë“±)  â”‚   â† Manager Web (HTML/CSS/JS) ë°°í¬
â”‚  flutter build web ê²°ê³¼ë¬¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
  </div>

  <div class="info-box">
    <strong>í•µì‹¬ í¬ì¸íŠ¸:</strong> ì „í†µì ì¸ êµ¬ì¡°(Client â†’ WAS â†’ DB)ì™€ ë‹¬ë¦¬, SupabaseëŠ” PostgRESTê°€ PostgreSQL í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ REST APIë¡œ ë…¸ì¶œí•©ë‹ˆë‹¤. ë³„ë„ì˜ ë°±ì—”ë“œ ì„œë²„ ì½”ë“œë¥¼ ì‘ì„±í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
  </div>

  <h3>ì „í†µì  êµ¬ì¡° vs ìš°ë¦¬ êµ¬ì¡° ë¹„êµ</h3>
  <div class="grid-2">
    <div class="card">
      <h4>ì „í†µì  êµ¬ì¡° (Spring Boot ë“±)</h4>
      <p>Client â†’ <strong>WAS (Java/Node.js)</strong> â†’ DB</p>
      <p style="margin-top:8px; font-size:12px; color:#999;">
        Controller â†’ Service â†’ Repository â†’ DB<br>
        ì„œë²„ ì½”ë“œ ì§ì ‘ ì‘ì„±, API ë¼ìš°íŒ… ì§ì ‘ ì„¤ê³„<br>
        ì„œë²„ ì¸í”„ë¼ ì§ì ‘ ê´€ë¦¬ (AWS EC2 ë“±)
      </p>
    </div>
    <div class="card" style="border-color: #4caf50;">
      <h4>ìš°ë¦¬ êµ¬ì¡° (Supabase Serverless)</h4>
      <p>Client â†’ <strong>Supabase SDK</strong> â†’ PostgREST â†’ DB</p>
      <p style="margin-top:8px; font-size:12px; color:#999;">
        Flutter SDKê°€ ì§ì ‘ DB ì¿¼ë¦¬ (í…Œì´ë¸” ê¸°ë°˜ API)<br>
        RLSë¡œ ë³´ì•ˆ, Triggerë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§<br>
        ì„œë²„ ê´€ë¦¬ ë¶ˆí•„ìš” (Supabaseê°€ ìš´ì˜)
      </p>
    </div>
  </div>
</div>

<!-- ==================== 2. TECH STACK ==================== -->
<div class="section" id="s2">
  <h2>2. ê¸°ìˆ  ìŠ¤íƒ êµ¬ì„±</h2>

  <div class="grid-3">
    <div class="card" style="text-align:center;">
      <div class="card-icon">&#x1F4F1;</div>
      <h4>Worker App (ê·¼ë¡œì)</h4>
      <span class="tag tag-blue">Flutter</span>
      <span class="tag tag-blue">Dart</span>
      <span class="tag tag-green">Riverpod</span>
      <span class="tag tag-orange">Geolocator</span>
      <p style="margin-top:8px;">Android / iOS<br>SMS OTP ë¡œê·¸ì¸<br>GPS ì¶œí‡´ê·¼</p>
    </div>
    <div class="card" style="text-align:center;">
      <div class="card-icon">&#x1F4BB;</div>
      <h4>Manager Web (ê´€ë¦¬ì)</h4>
      <span class="tag tag-blue">Flutter Web</span>
      <span class="tag tag-blue">Dart</span>
      <span class="tag tag-green">Riverpod</span>
      <span class="tag tag-purple">Material 3</span>
      <p style="margin-top:8px;">Chrome ë¸Œë¼ìš°ì €<br>Email/PW ë¡œê·¸ì¸<br>ëŒ€ì‹œë³´ë“œ/ê¸‰ì—¬/ê·¼íƒœ</p>
    </div>
    <div class="card" style="text-align:center;">
      <div class="card-icon">&#x2601;</div>
      <h4>Backend (Supabase)</h4>
      <span class="tag tag-red">PostgreSQL</span>
      <span class="tag tag-red">PostgREST</span>
      <span class="tag tag-purple">GoTrue Auth</span>
      <span class="tag tag-orange">Edge Fn</span>
      <p style="margin-top:8px;">DB + Auth + API<br>RLS ë³´ì•ˆ<br>Trigger ìë™ê³„ì‚°</p>
    </div>
  </div>

  <h3>ê³µìœ  íŒ¨í‚¤ì§€ (Dart Workspace Monorepo)</h3>
  <table>
    <tr><th>íŒ¨í‚¤ì§€</th><th>ê²½ë¡œ</th><th>ì—­í• </th></tr>
    <tr><td><code>core</code></td><td><code>packages/core/</code></td><td>Freezed ë°ì´í„° ëª¨ë¸ (Worker, Attendance, Payroll ë“±), ê³µìœ  ì„œë¹„ìŠ¤</td></tr>
    <tr><td><code>supabase_client</code></td><td><code>packages/supabase_client/</code></td><td>SupabaseService ì‹±ê¸€í†¤, Riverpod í”„ë¡œë°”ì´ë”, ì˜ˆì™¸ ì²˜ë¦¬</td></tr>
    <tr><td><code>ui_components</code></td><td><code>packages/ui_components/</code></td><td>ì¬ì‚¬ìš© ìœ„ì ¯ (StatusBadge, SummaryCard ë“±)</td></tr>
  </table>
</div>

<!-- ==================== 3. SUPABASE BACKEND ==================== -->
<div class="section" id="s3">
  <h2>3. Supabase ë°±ì—”ë“œ êµ¬ì¡°</h2>
  <p>SupabaseëŠ” 4ê°œì˜ í•µì‹¬ ì„œë¹„ìŠ¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ê° ì„œë¹„ìŠ¤ê°€ ì „í†µì  ë°±ì—”ë“œì˜ ì–´ë–¤ ì—­í• ì„ ëŒ€ì²´í•˜ëŠ”ì§€ ë§¤í•‘í•©ë‹ˆë‹¤.</p>

  <table>
    <tr><th>Supabase ì„œë¹„ìŠ¤</th><th>ì „í†µì  ëŒ€ì‘</th><th>ì—­í• </th><th>ìš°ë¦¬ í”„ë¡œì íŠ¸ ì‚¬ìš©ì²˜</th></tr>
    <tr>
      <td><strong>GoTrue (Auth)</strong></td>
      <td>Spring Security, Passport.js</td>
      <td>ì‚¬ìš©ì ì¸ì¦, JWT í† í° ë°œê¸‰/ê²€ì¦</td>
      <td>SMS OTP (ê·¼ë¡œì), Email/PW (ê´€ë¦¬ì)</td>
    </tr>
    <tr>
      <td><strong>PostgREST (API)</strong></td>
      <td>REST Controller + Service Layer</td>
      <td>í…Œì´ë¸”ì„ ìë™ REST APIë¡œ ë…¸ì¶œ<br><code>GET/POST/PATCH/DELETE /rest/v1/{table}</code></td>
      <td>ëª¨ë“  CRUD (workers, attendances, payrolls...)</td>
    </tr>
    <tr>
      <td><strong>PostgreSQL (DB)</strong></td>
      <td>MySQL, Oracle ë“±</td>
      <td>ë°ì´í„° ì €ì¥, Trigger, Function, RLS</td>
      <td>6ê°œ í…Œì´ë¸” + 2ê°œ Trigger + RLS ì •ì±…</td>
    </tr>
    <tr>
      <td><strong>Edge Functions</strong></td>
      <td>Lambda, Cloud Functions</td>
      <td>ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Deno/TypeScript)</td>
      <td>ê¸‰ì—¬ ê³„ì‚° (<code>calculate-payroll</code>)</td>
    </tr>
    <tr>
      <td><strong>Realtime</strong> (ë¯¸ì‚¬ìš©)</td>
      <td>WebSocket ì„œë²„</td>
      <td>ì‹¤ì‹œê°„ ë°ì´í„° ë³€ê²½ ì•Œë¦¼</td>
      <td>í–¥í›„: ì¶œê·¼ ì•Œë¦¼, ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</td>
    </tr>
    <tr>
      <td><strong>Storage</strong> (ë¯¸ì‚¬ìš©)</td>
      <td>AWS S3, Azure Blob</td>
      <td>íŒŒì¼/ì´ë¯¸ì§€ ì €ì¥</td>
      <td>í–¥í›„: í”„ë¡œí•„ ì‚¬ì§„, ë¬¸ì„œ ì—…ë¡œë“œ</td>
    </tr>
  </table>

  <h3>PostgRESTê°€ APIë¥¼ ìë™ ìƒì„±í•˜ëŠ” ì›ë¦¬</h3>
  <div class="diagram">
<pre>
í…Œì´ë¸” ì •ì˜:                    ìë™ ìƒì„±ë˜ëŠ” REST API:

CREATE TABLE workers (         GET    /rest/v1/workers           â†’ SELECT *
  id UUID,                     GET    /rest/v1/workers?id=eq.xxx â†’ SELECT WHERE id=xxx
  name TEXT,                   POST   /rest/v1/workers           â†’ INSERT
  phone TEXT,                  PATCH  /rest/v1/workers?id=eq.xxx â†’ UPDATE
  ...                          DELETE /rest/v1/workers?id=eq.xxx â†’ DELETE
);
                               â€» ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í•„í„°ë§:
                               ?name=eq.ê¹€ì˜ìˆ˜
                               ?check_in_time=gte.2026-02-12
                               ?select=name,phone,site:sites(name)  â† JOINë„ ê°€ëŠ¥!
</pre>
  </div>

  <div class="info-box">
    <strong>Flutter SDKì—ì„œëŠ” ì´ë ‡ê²Œ í˜¸ì¶œ:</strong><br>
    <code>supabase.from('workers').select('*, sites(name)').eq('site_id', siteId)</code><br>
    â†’ SDKê°€ ë‚´ë¶€ì ìœ¼ë¡œ <code>GET /rest/v1/workers?select=*,sites(name)&site_id=eq.{siteId}</code> HTTP ìš”ì²­ìœ¼ë¡œ ë³€í™˜
  </div>
</div>

<!-- ==================== 4. DATABASE SCHEMA ==================== -->
<div class="section" id="s4">
  <h2>4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ &amp; í…Œì´ë¸” ê´€ê³„</h2>

  <div class="diagram">
<pre>
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚       sites           â”‚
                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                          â”‚ id (PK, UUID)         â”‚
                          â”‚ name                  â”‚
                          â”‚ latitude / longitude  â”‚
                          â”‚ radius (GPS ë°˜ê²½)     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ 1
                                      â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                  â”‚                   â”‚
                   â”‚ N                â”‚ N                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
          â”‚    workers      â”‚  â”‚    parts         â”‚       â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â”‚
          â”‚ id (PK, UUID)  â”‚  â”‚ id (PK, UUID)   â”‚       â”‚
          â”‚ name           â”‚  â”‚ name             â”‚       â”‚
          â”‚ phone (UNIQUE) â”‚  â”‚ hourly_wage      â”‚       â”‚
          â”‚ site_id (FK)â”€â”€â”€â”¤  â”‚ daily_wage       â”‚       â”‚
          â”‚ part_id (FK)â”€â”€â”€â”¼â”€â”€â”˜                  â”‚       â”‚
          â”‚ role           â”‚                     â”‚       â”‚
          â”‚ is_active      â”‚                     â”‚       â”‚
          â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚       â”‚
             â”‚      â”‚                            â”‚       â”‚
             â”‚ 1    â”‚ 1                          â”‚       â”‚
             â”‚      â”‚                            â”‚       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚       â”‚
    â”‚attendancesâ”‚  â”‚worker_profiles  â”‚          â”‚       â”‚
    â”‚(N records)â”‚  â”‚(1:1)            â”‚          â”‚       â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚       â”‚
    â”‚ id (PK)   â”‚  â”‚ worker_id (FK)  â”‚          â”‚       â”‚
    â”‚ worker_id â”‚  â”‚ company         â”‚          â”‚       â”‚
    â”‚ check_in  â”‚  â”‚ employee_id     â”‚          â”‚       â”‚
    â”‚ check_out â”‚  â”‚ ssn, address    â”‚          â”‚       â”‚
    â”‚ work_hoursâ”‚  â”‚ bank            â”‚          â”‚       â”‚
    â”‚  (trigger â”‚  â”‚ account_number  â”‚          â”‚       â”‚
    â”‚  ìë™ê³„ì‚°) â”‚  â”‚ email, position â”‚          â”‚       â”‚
    â”‚ lat/lng   â”‚  â”‚ join_date       â”‚          â”‚       â”‚
    â”‚ status    â”‚  â”‚ leave_date      â”‚          â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚       â”‚
             â”‚                                   â”‚       â”‚
             â”‚ N                                 â”‚       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚       â”‚
    â”‚     payrolls       â”‚                       â”‚       â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚       â”‚
    â”‚ id (PK)            â”‚                       â”‚       â”‚
    â”‚ worker_id (FK)     â”‚                       â”‚       â”‚
    â”‚ year_month         â”‚                       â”‚       â”‚
    â”‚ total_work_hours   â”‚                       â”‚       â”‚
    â”‚ total_work_days    â”‚                       â”‚       â”‚
    â”‚ base_salary        â”‚                       â”‚       â”‚
    â”‚ total_salary       â”‚                       â”‚       â”‚
    â”‚ is_finalized       â”‚                       â”‚       â”‚
    â”‚ UNIQUE(worker_id,  â”‚                       â”‚       â”‚
    â”‚   year_month)      â”‚                       â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚       â”‚
                                                 â”‚       â”‚
  Role ì¢…ë¥˜:                                     â”‚       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚  worker         = ì¼ë°˜ ê·¼ë¡œì (Worker App)            â”‚
  â”‚  center_manager = ì„¼í„° ê´€ë¦¬ì (Manager Web)           â”‚
  â”‚  owner          = ëŒ€í‘œ/ì„ì› (Manager Web, ì „ì²´ ì ‘ê·¼)   â”‚
  â”‚  system_admin   = ì‹œìŠ¤í…œ ê´€ë¦¬ì (Manager Web, ì „ì²´ ì ‘ê·¼)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
  </div>

  <h3>PostgreSQL Trigger: ê·¼ë¬´ì‹œê°„ ìë™ ê³„ì‚°</h3>
  <div class="diagram">
<pre>
Worker Appì—ì„œ í‡´ê·¼ (UPDATE attendances SET check_out_time = NOW())
    â”‚
    â–¼
Trigger: calculate_work_hours() ìë™ ì‹¤í–‰
    â”‚
    â”œâ”€ check_out_timeì´ NULLì´ë©´ â†’ ìŠ¤í‚µ
    â”œâ”€ check_out_timeì´ ìˆìœ¼ë©´ â†’
    â”‚   work_hours = (check_out_time - check_in_time) / 3600ì´ˆ
    â”‚   ì˜ˆ: 09:00 ì¶œê·¼, 18:00 í‡´ê·¼ â†’ work_hours = 9.0
    â”‚
    â–¼
work_hours ì»¬ëŸ¼ì´ ìë™ìœ¼ë¡œ ì±„ì›Œì§ (í”„ë¡ íŠ¸ì—ì„œ ê³„ì‚° ë¶ˆí•„ìš”!)
</pre>
  </div>
</div>

<!-- ==================== 5. API COMMUNICATION ==================== -->
<div class="section" id="s5">
  <h2>5. API í†µì‹  ì›ë¦¬ (REST API + JWT)</h2>

  <h3>ëª¨ë“  API ìš”ì²­ì˜ ê¸°ë³¸ íë¦„</h3>
  <div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flutter App (Client)                               â”‚
â”‚                                                                      â”‚
â”‚  supabase.from('attendances')                                        â”‚
â”‚    .insert({ 'worker_id': '...', 'check_in_time': '...' })         â”‚
â”‚    .select()                                                         â”‚
â”‚    .single();                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼  Supabase SDKê°€ ìë™ ë³€í™˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP Request                                                        â”‚
â”‚                                                                      â”‚
â”‚  POST https://xxxx.supabase.co/rest/v1/attendances                  â”‚
â”‚                                                                      â”‚
â”‚  Headers:                                                            â”‚
â”‚    apikey: eyJhbGciOiJIUzI1...  (SUPABASE_ANON_KEY)                â”‚
â”‚    Authorization: Bearer eyJhbGciOiJIUzI1...  (ë¡œê·¸ì¸ í›„ ë°›ì€ JWT)   â”‚
â”‚    Content-Type: application/json                                    â”‚
â”‚    Prefer: return=representation  (INSERT í›„ ê²°ê³¼ ë°˜í™˜)              â”‚
â”‚                                                                      â”‚
â”‚  Body:                                                               â”‚
â”‚    { "worker_id": "550e8400-...", "check_in_time": "2026-02-12..." } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase API Gateway (Kong)                                         â”‚
â”‚                                                                      â”‚
â”‚  1. apikey ê²€ì¦ â†’ ìœ íš¨í•œ í”„ë¡œì íŠ¸ í‚¤ì¸ì§€ í™•ì¸                          â”‚
â”‚  2. JWT í† í° ê²€ì¦ â†’ ë§Œë£Œ ì—¬ë¶€, ì„œëª… í™•ì¸                               â”‚
â”‚  3. JWTì—ì„œ user_id ì¶”ì¶œ â†’ auth.uid() ë¡œ ì‚¬ìš©                        â”‚
â”‚  4. PostgRESTë¡œ ì „ë‹¬                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgREST                                                           â”‚
â”‚                                                                      â”‚
â”‚  1. HTTP ìš”ì²­ì„ SQLë¡œ ë³€í™˜:                                            â”‚
â”‚     INSERT INTO attendances (worker_id, check_in_time)               â”‚
â”‚     VALUES ('550e8400-...', '2026-02-12T09:00:00Z')                 â”‚
â”‚     RETURNING *;                                                     â”‚
â”‚                                                                      â”‚
â”‚  2. RLS ì •ì±… ì ìš© (SET request.jwt.claims):                           â”‚
â”‚     â†’ auth.uid() = '550e8400-...'                                    â”‚
â”‚     â†’ get_my_role() = 'worker'                                       â”‚
â”‚     â†’ CHECK: worker_id = auth.uid() â†’ âœ… í†µê³¼                        â”‚
â”‚                                                                      â”‚
â”‚  3. Trigger ì‹¤í–‰: calculate_work_hours()                              â”‚
â”‚     â†’ check_out_time IS NULL â†’ work_hours ê³„ì‚° ìŠ¤í‚µ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP Response                                                       â”‚
â”‚                                                                      â”‚
â”‚  Status: 201 Created                                                 â”‚
â”‚  Body: {                                                             â”‚
â”‚    "id": "new-uuid",                                                 â”‚
â”‚    "worker_id": "550e8400-...",                                      â”‚
â”‚    "check_in_time": "2026-02-12T09:00:00.000Z",                    â”‚
â”‚    "check_out_time": null,                                           â”‚
â”‚    "work_hours": null,                                               â”‚
â”‚    "status": "present"                                               â”‚
â”‚  }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flutter App (Client)                                                â”‚
â”‚                                                                      â”‚
â”‚  JSON â†’ Attendance ëª¨ë¸ (Freezed) ë³€í™˜                                â”‚
â”‚  â†’ StateNotifier ìƒíƒœ ì—…ë°ì´íŠ¸                                        â”‚
â”‚  â†’ UI ìë™ ë¦¬ë Œë”ë§ (Riverpod watch)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
  </div>

  <h3>JWT í† í°ì˜ êµ¬ì¡°</h3>
  <div class="diagram">
<pre>
JWT = Header.Payload.Signature

Payload (ë””ì½”ë”©í•˜ë©´):
{
  "sub": "550e8400-e29b-41d4-a716-446655440000",   â† auth.uid() ë¡œ ì‚¬ìš©
  "phone": "+821012345678",                          â† ì¸ì¦ëœ ì „í™”ë²ˆí˜¸
  "role": "authenticated",                           â† Supabase ê¸°ë³¸ role
  "aud": "authenticated",
  "exp": 1739404800,                                 â† ë§Œë£Œ ì‹œê° (ìë™ ê°±ì‹ )
  "iat": 1739401200                                  â† ë°œê¸‰ ì‹œê°
}

â€» sub (subject) = workers í…Œì´ë¸”ì˜ idì™€ ë™ì¼
â€» Flutter SDKê°€ JWTë¥¼ ìë™ ì €ì¥/ê°±ì‹ /ì²¨ë¶€
â€» ì•± ê°œë°œìê°€ í† í°ì„ ì§ì ‘ ê´€ë¦¬í•  í•„ìš” ì—†ìŒ
</pre>
  </div>

  <h3>ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸ ë§¤í•‘</h3>
  <table>
    <tr><th>Flutter ì½”ë“œ</th><th>ì‹¤ì œ HTTP ìš”ì²­</th><th>ì‚¬ìš©ì²˜</th></tr>
    <tr>
      <td><code>supabase.auth.signInWithOtp(phone:)</code></td>
      <td><code>POST /auth/v1/otp</code></td>
      <td>ê·¼ë¡œì SMS ì¸ì¦ë²ˆí˜¸ ì „ì†¡</td>
    </tr>
    <tr>
      <td><code>supabase.auth.verifyOTP()</code></td>
      <td><code>POST /auth/v1/verify</code></td>
      <td>ì¸ì¦ë²ˆí˜¸ í™•ì¸ â†’ JWT ë°œê¸‰</td>
    </tr>
    <tr>
      <td><code>supabase.auth.signInWithPassword()</code></td>
      <td><code>POST /auth/v1/token?grant_type=password</code></td>
      <td>ê´€ë¦¬ì ì´ë©”ì¼ ë¡œê·¸ì¸</td>
    </tr>
    <tr>
      <td><code>supabase.from('workers').select()</code></td>
      <td><code>GET /rest/v1/workers?select=*</code></td>
      <td>ê·¼ë¡œì ëª©ë¡ ì¡°íšŒ</td>
    </tr>
    <tr>
      <td><code>.from('attendances').insert()</code></td>
      <td><code>POST /rest/v1/attendances</code></td>
      <td>ì¶œê·¼ ê¸°ë¡</td>
    </tr>
    <tr>
      <td><code>.from('attendances').update().eq('id',x)</code></td>
      <td><code>PATCH /rest/v1/attendances?id=eq.{x}</code></td>
      <td>í‡´ê·¼ ê¸°ë¡</td>
    </tr>
    <tr>
      <td><code>.from('worker_profiles').upsert()</code></td>
      <td><code>POST /rest/v1/worker_profiles (+ Prefer: resolution=merge-duplicates)</code></td>
      <td>í”„ë¡œí•„ ì €ì¥ (ìˆìœ¼ë©´ UPDATE, ì—†ìœ¼ë©´ INSERT)</td>
    </tr>
  </table>
</div>

<!-- ==================== 6. AUTH FLOW ==================== -->
<div class="section" id="s6">
  <h2>6. ì¸ì¦(Auth) íë¦„ ìƒì„¸</h2>

  <h3>6-1. Worker App: SMS OTP ë¡œê·¸ì¸</h3>
  <div class="flow-container">
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">1</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">LoginScreen â€” ë¡œê·¸ì¸ ë°©ì‹ ì„ íƒ</div>
        <div class="desc">ì¹´ì¹´ì˜¤ / êµ¬ê¸€ / SMS ì¤‘ SMS ì„ íƒ<br>ì „í™”ë²ˆí˜¸ ì…ë ¥ (01012345678)</div>
        <span class="tech">UI Only (API í˜¸ì¶œ ì—†ìŒ)</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">2</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">sendOtp() â€” SMS ë°œì†¡ ìš”ì²­</div>
        <div class="desc">
          <code>010-1234-5678</code> â†’ <code>+821012345678</code> (E.164 ë³€í™˜)<br>
          <code>supabase.auth.signInWithOtp(phone: '+821012345678')</code><br>
          Supabaseê°€ Twilioë¥¼ í†µí•´ 6ìë¦¬ ì¸ì¦ë²ˆí˜¸ SMS ì „ì†¡
        </div>
        <span class="tech">POST /auth/v1/otp â†’ Twilio SMS</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">3</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">verifyOtp() â€” ì¸ì¦ë²ˆí˜¸ í™•ì¸</div>
        <div class="desc">
          ì‚¬ìš©ìê°€ 6ìë¦¬ ì…ë ¥ â†’ <code>supabase.auth.verifyOTP(phone, token, type: sms)</code><br>
          ì„±ê³µ ì‹œ: JWT í† í° ë°œê¸‰ + <code>auth.users</code> í…Œì´ë¸”ì— ì‚¬ìš©ì ìƒì„±/ì¡°íšŒ<br>
          â†’ <code>workers</code> í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì „í™”ë²ˆí˜¸ì˜ Worker ì¡°íšŒ
        </div>
        <span class="tech">POST /auth/v1/verify â†’ JWT ë°œê¸‰</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">4</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">isProfileComplete() â€” í”„ë¡œí•„ ì™„ì„± ì—¬ë¶€ í™•ì¸</div>
        <div class="desc">
          <code>worker_profiles</code> í…Œì´ë¸”ì—ì„œ <code>ssn</code>ê³¼ <code>address</code>ê°€ ìˆëŠ”ì§€ í™•ì¸<br>
          ë¯¸ì™„ì„± â†’ <code>AuthStatus.needsConsent</code> (ë™ì˜ í™”ë©´ìœ¼ë¡œ)<br>
          ì™„ì„±ë¨ â†’ <code>AuthStatus.authenticated</code> (í™ˆ í™”ë©´ìœ¼ë¡œ)
        </div>
        <span class="tech">GET /rest/v1/worker_profiles?worker_id=eq.{id}</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">5</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">ConsentScreen â€” ê°œì¸ì •ë³´ ë™ì˜</div>
        <div class="desc">í•„ìˆ˜: ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ / ì„ íƒ: ìœ„ì¹˜ì •ë³´ ë™ì˜</div>
        <span class="tech">UI Only (ë™ì˜ ì—¬ë¶€ ë¡œì»¬ ì €ì¥)</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">6</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">ProfileCompletionScreen â€” ì¶”ê°€ ì •ë³´ ì…ë ¥</div>
        <div class="desc">
          ì£¼ë¯¼ë²ˆí˜¸, ì£¼ì†Œ, ì€í–‰, ê³„ì¢Œë²ˆí˜¸ ì…ë ¥<br>
          <code>saveProfile()</code> â†’ <code>worker_profiles</code> í…Œì´ë¸”ì— UPSERT
        </div>
        <span class="tech">POST /rest/v1/worker_profiles (upsert)</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">7</div></div>
      <div class="flow-content">
        <div class="title">HomeScreen â€” ì¶œí‡´ê·¼ í™”ë©´</div>
        <div class="desc"><code>AuthStatus.authenticated</code> â†’ ì¶œê·¼/í‡´ê·¼ ë²„íŠ¼ í™œì„±í™”</div>
        <span class="tech">ì¸ì¦ ì™„ë£Œ, JWT ìë™ ì²¨ë¶€</span>
      </div>
    </div>
  </div>

  <h3>6-2. Manager Web: Email/Password ë¡œê·¸ì¸</h3>
  <div class="flow-container">
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">1</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">LoginScreen â€” ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</div>
        <div class="desc"><code>supabase.auth.signInWithPassword(email, password)</code></div>
        <span class="tech">POST /auth/v1/token?grant_type=password</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">2</div><div class="flow-line"></div></div>
      <div class="flow-content">
        <div class="title">Role í™•ì¸ â€” ì ‘ê·¼ ê¶Œí•œ ì²´í¬</div>
        <div class="desc">
          <code>workers</code> í…Œì´ë¸”ì—ì„œ role ì¡°íšŒ<br>
          <code>worker</code> roleì´ë©´ ì ‘ê·¼ ê±°ë¶€ ("ê´€ë¦¬ì ê³„ì •ë§Œ ì ‘ê·¼ ê°€ëŠ¥")<br>
          <code>center_manager</code> / <code>owner</code> / <code>system_admin</code>ì´ë©´ í†µê³¼
        </div>
        <span class="tech">GET /rest/v1/workers?id=eq.{auth.uid()}</span>
      </div>
    </div>
    <div class="flow-step">
      <div class="flow-num"><div class="flow-circle">3</div></div>
      <div class="flow-content">
        <div class="title">ManagerShell â€” ëŒ€ì‹œë³´ë“œ ì§„ì…</div>
        <div class="desc">
          RBAC ê¸°ë°˜ ë©”ë‰´ ì œí•œ:<br>
          <code>center_manager</code>: í™ˆ/ê·¼ë¡œì/ê·¼íƒœ/ê¸‰ì—¬<br>
          <code>owner</code>: + ì„¤ì •<br>
          <code>system_admin</code>: + ê³„ì •ê´€ë¦¬ (ì „ì²´ ì ‘ê·¼)
        </div>
        <span class="tech">canAccessMenu(role, menuIndex) ë¡œ í•„í„°</span>
      </div>
    </div>
  </div>

  <h3>AuthStatus ìƒíƒœ ì „ì´ë„</h3>
  <div class="diagram">
<pre>
                    ì•± ì‹œì‘
                      â”‚
                      â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   initial    â”‚
               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Supabase session í™•ì¸
                      â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                   â”‚
     ì„¸ì…˜ ì—†ìŒ               ì„¸ì…˜ ìˆìŒ
            â”‚                   â”‚
            â–¼                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ unauthenticated â”‚  â”‚  (worker ì¡°íšŒ)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                  â”‚
        ë¡œê·¸ì¸ ì‹œë„        í”„ë¡œí•„ ì²´í¬
            â”‚                  â”‚
            â–¼          â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚               â”‚
     â”‚ loading â”‚    ë¯¸ì™„ì„±           ì™„ì„±ë¨
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚               â”‚
          â”‚            â–¼               â–¼
          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â””â”€â”€â†’â”‚needsConsent â”‚  â”‚authenticated â”‚â—„â”€â”€â”€â”€ ìµœì¢… ìƒíƒœ
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ ë™ì˜ ì™„ë£Œ
                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚needsProfileCompletionâ”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ í”„ë¡œí•„ ì €ì¥
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚authenticated â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
  </div>
</div>

<!-- ==================== 7. RIVERPOD STATE ==================== -->
<div class="section" id="s7">
  <h2>7. í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœê´€ë¦¬ (Riverpod)</h2>
  <p>Riverpodì€ Flutterì˜ ìƒíƒœê´€ë¦¬ í”„ë ˆì„ì›Œí¬ë¡œ, ë°ì´í„°ì˜ íë¦„ì„ <strong>ë‹¨ë°©í–¥(Unidirectional)</strong>ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>

  <h3>ê³„ì¸µ êµ¬ì¡°: UI â†’ Provider â†’ Repository â†’ Supabase</h3>
  <div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (UI)                                     â”‚
â”‚                                                              â”‚
â”‚  DashboardScreen / HomeScreen / WorkersScreen ...           â”‚
â”‚  â””â”€ ref.watch(provider) â† ìƒíƒœ ë³€í™” ê°ì§€, ìë™ ë¦¬ë Œë”ë§      â”‚
â”‚  â””â”€ ref.read(provider.notifier).action() â† ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ watch / read
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Provider Layer (ìƒíƒœ ê´€ë¦¬)                                    â”‚
â”‚                                                              â”‚
â”‚  StateNotifierProvider â†’ ë³µì¡í•œ ìƒíƒœ (Auth, Attendance)       â”‚
â”‚  FutureProvider       â†’ ë¹„ë™ê¸° ë°ì´í„° (Dashboard, Payroll)    â”‚
â”‚  StateProvider        â†’ ë‹¨ìˆœ ìƒíƒœ (ì„ íƒëœ ì›”, í•„í„°)            â”‚
â”‚  Provider             â†’ ì‹±ê¸€í†¤ (Repository ì¸ìŠ¤í„´ìŠ¤)          â”‚
â”‚                                                              â”‚
â”‚  â€» Provider ê°„ ì˜ì¡´ì„±:                                        â”‚
â”‚  dashboardSummaryProvider                                    â”‚
â”‚    â””â”€ watches authProvider.worker.siteId                     â”‚
â”‚    â””â”€ siteId ë³€ê²½ ì‹œ ìë™ ì¬ìš”ì²­                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ í˜¸ì¶œ
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Repository Layer (ë°ì´í„° ì ‘ê·¼)                                â”‚
â”‚                                                              â”‚
â”‚  DashboardRepository / AttendanceRepository / ...            â”‚
â”‚  â””â”€ Supabase ì¿¼ë¦¬ ë¹Œë“œ                                       â”‚
â”‚  â””â”€ JSON â†’ Dart Model ë³€í™˜                                   â”‚
â”‚  â””â”€ ì—ëŸ¬ í•¸ë“¤ë§                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP (SDK)
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SupabaseService (packages/supabase_client)                  â”‚
â”‚                                                              â”‚
â”‚  ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ â†’ supabase.from('table').select/insert/...   â”‚
â”‚  Auth ê´€ë¦¬ â†’ supabase.auth.signInWith... / signOut           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
  </div>

  <h3>Provider ì˜ì¡´ì„± ê·¸ë˜í”„</h3>
  <div class="diagram">
<pre>
supabaseServiceProvider
    â”‚
    â”œâ”€â”€â†’ authProvider (StateNotifier)
    â”‚       â”‚
    â”‚       â”œâ”€â”€â†’ dashboardSummaryProvider (FutureProvider)
    â”‚       â”‚       â””â”€ watches: authProvider.worker.siteId
    â”‚       â”‚
    â”‚       â”œâ”€â”€â†’ todayAttendancesProvider (FutureProvider)
    â”‚       â”‚       â””â”€ watches: authProvider.worker.siteId
    â”‚       â”‚
    â”‚       â”œâ”€â”€â†’ sitesProvider (FutureProvider)
    â”‚       â”‚
    â”‚       â”œâ”€â”€â†’ workersProvider (FutureProvider)
    â”‚       â”‚       â””â”€ watches: authProvider.worker.siteId
    â”‚       â”‚
    â”‚       â”œâ”€â”€â†’ payrollDataProvider (FutureProvider)
    â”‚       â”‚       â””â”€ watches: selectedYearMonthProvider
    â”‚       â”‚       â””â”€ watches: authProvider.worker.siteId
    â”‚       â”‚
    â”‚       â””â”€â”€â†’ attendanceProvider (StateNotifier) [Worker App]
    â”‚               â””â”€ uses: attendanceRepositoryProvider
    â”‚
    â””â”€â”€â†’ selectedYearMonthProvider (StateProvider) â†’ '2026-02'
</pre>
  </div>
</div>

<!-- ==================== 8. DATA FLOW EXAMPLE ==================== -->
<div class="section" id="s8">
  <h2>8. ì‹¤ì œ ë°ì´í„° íë¦„ ì˜ˆì‹œ</h2>

  <h3>8-1. ê·¼ë¡œìê°€ ì¶œê·¼ â†’ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì— ë°˜ì˜</h3>

  <div class="diagram">
<pre>
[Worker App - ê·¼ë¡œì ê¹€ì˜ìˆ˜ì˜ í°]

1ï¸âƒ£  HomeScreen: "ì¶œê·¼" ë²„íŠ¼ í´ë¦­
    â”‚
2ï¸âƒ£  AttendanceNotifier.checkIn('worker-uuid-001')
    â”‚
3ï¸âƒ£  GPS ìœ„ì¹˜ ìˆ˜ì§‘
    â”‚   Geolocator.getCurrentPosition()
    â”‚   â†’ latitude: 37.0080, longitude: 127.2797
    â”‚
4ï¸âƒ£  AttendanceRepository.checkIn('worker-uuid-001', 37.0080, 127.2797)
    â”‚
5ï¸âƒ£  HTTP ìš”ì²­ ì „ì†¡
    â”‚   POST https://xxxx.supabase.co/rest/v1/attendances
    â”‚   Authorization: Bearer {ê¹€ì˜ìˆ˜ì˜ JWT}
    â”‚   Body: {
    â”‚     "worker_id": "worker-uuid-001",
    â”‚     "check_in_time": "2026-02-12T09:05:00.000Z",
    â”‚     "check_in_latitude": 37.0080,
    â”‚     "check_in_longitude": 127.2797,
    â”‚     "status": "present"
    â”‚   }
    â”‚
6ï¸âƒ£  Supabase ì²˜ë¦¬
    â”‚   â”œâ”€ RLS ì²´í¬: auth.uid() == worker_id âœ…
    â”‚   â”œâ”€ INSERT INTO attendances
    â”‚   â”œâ”€ Trigger: check_out_time NULL â†’ work_hours ìŠ¤í‚µ
    â”‚   â””â”€ RETURNING * â†’ JSON ì‘ë‹µ
    â”‚
7ï¸âƒ£  AttendanceNotifier ìƒíƒœ ì—…ë°ì´íŠ¸
    â”‚   state = AttendanceState(
    â”‚     status: checkedIn,
    â”‚     todayAttendance: Attendance(checkInTime: 09:05, ...)
    â”‚   )
    â”‚
8ï¸âƒ£  HomeScreen ë¦¬ë Œë”ë§
    â””â”€ ì¶œê·¼ ì‹œê°„ ì¹´ë“œ í‘œì‹œ: "ì¶œê·¼ 09:05:00"
       í‡´ê·¼ ë²„íŠ¼ í™œì„±í™”


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[Manager Web - ê´€ë¦¬ìì˜ PC ë¸Œë¼ìš°ì €]

9ï¸âƒ£  ê´€ë¦¬ìê°€ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ì ‘ì† (ë˜ëŠ” ìƒˆë¡œê³ ì¹¨)
    â”‚
ğŸ”Ÿ  DashboardScreen ë¹Œë“œ â†’ ref.watch(todayAttendancesProvider)
    â”‚
1ï¸âƒ£1ï¸âƒ£ DashboardRepository.getTodayAttendances(siteId)
    â”‚
1ï¸âƒ£2ï¸âƒ£ HTTP ìš”ì²­ 2ê°œ ë³‘ë ¬ ì „ì†¡
    â”‚   â”œâ”€ GET /rest/v1/workers?is_active=eq.true&select=*,worker_profiles(*)
    â”‚   â””â”€ GET /rest/v1/attendances?check_in_time=gte.2026-02-12T00:00:00
    â”‚
1ï¸âƒ£3ï¸âƒ£ Dartì—ì„œ ë³‘í•© (merge)
    â”‚   â”œâ”€ ì „ì²´ ê·¼ë¡œì 45ëª…
    â”‚   â”œâ”€ ì˜¤ëŠ˜ ì¶œê·¼ ê¸°ë¡ 42ê±´
    â”‚   â””â”€ ë§¤ì¹­: 42ëª… ì¶œê·¼ + 3ëª… ë¯¸ì¶œê·¼
    â”‚
1ï¸âƒ£4ï¸âƒ£ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
    â””â”€ ìš”ì•½ ì¹´ë“œ: ì¶œê·¼ 42 / ì§€ê° 3 / ë¯¸ì¶œê·¼ 3
       í…Œì´ë¸”: ê¹€ì˜ìˆ˜ | 09:05 | - | ì¶œê·¼ ì¤‘ | ...
</pre>
  </div>

  <div class="success-box">
    <strong>í•µì‹¬:</strong> Worker Appì—ì„œ ì¶œê·¼í•œ ë°ì´í„°ê°€ <strong>ê°™ì€ Supabase DB</strong>ì— ì €ì¥ë˜ë¯€ë¡œ, Manager Webì—ì„œ ì¡°íšŒí•˜ë©´ <strong>ì‹¤ì‹œê°„ ë°ì´í„°</strong>ê°€ ë°”ë¡œ ë³´ì…ë‹ˆë‹¤. ë³„ë„ì˜ ë™ê¸°í™” ë¡œì§ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤.
  </div>

  <h3>8-2. ê´€ë¦¬ìê°€ ê¸‰ì—¬ ì¡°íšŒ</h3>
  <div class="diagram">
<pre>
[Manager Web - PayrollScreen]

1ï¸âƒ£  ê´€ë¦¬ìê°€ "2026ë…„ 1ì›”" ì„ íƒ â†’ selectedYearMonthProvider = '2026-01'
    â”‚
2ï¸âƒ£  payrollDataProvider ìë™ ì¬ì‹¤í–‰ (watch ì˜ì¡´ì„±)
    â”‚
3ï¸âƒ£  PayrollRepository.calculatePayroll(siteId, '2026-01')
    â”‚
4ï¸âƒ£  Supabase ì¿¼ë¦¬ 3ê°œ:
    â”‚   â”œâ”€ workers (ì´ë¦„, íŒŒíŠ¸)
    â”‚   â”œâ”€ attendances (1ì›” ì¶œê·¼ ê¸°ë¡ â†’ work_hours í•©ì‚°)
    â”‚   â””â”€ parts (ì‹œê¸‰ ì •ë³´)
    â”‚
5ï¸âƒ£  Dartì—ì„œ ê¸‰ì—¬ ê³„ì‚°:
    â”‚   ê¹€ì˜ìˆ˜: 170.5ì‹œê°„ Ã— 13,000ì› = 2,216,500ì›
    â”‚   ì´ë¯¼í˜¸: 160.0ì‹œê°„ Ã— 10,000ì› = 1,600,000ì›
    â”‚
6ï¸âƒ£  PayrollScreen í…Œì´ë¸” ë Œë”ë§
    â””â”€ ì´ë¦„ | íŒŒíŠ¸ | ê·¼ë¬´ì¼ìˆ˜ | ê·¼ë¬´ì‹œê°„ | ì‹œê¸‰ | ê¸°ë³¸ê¸‰ | ì´ê¸‰ì—¬
</pre>
  </div>
</div>

<!-- ==================== 9. RLS SECURITY ==================== -->
<div class="section" id="s9">
  <h2>9. ë³´ì•ˆ: RLS (Row Level Security)</h2>
  <p>RLSëŠ” <strong>ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ í–‰(row) ë‹¨ìœ„ë¡œ ì ‘ê·¼ì„ ì œí•œ</strong>í•˜ëŠ” PostgreSQL ê¸°ëŠ¥ì…ë‹ˆë‹¤. APIë¥¼ ìš°íšŒí•´ë„ DBì—ì„œ ì°¨ë‹¨ë©ë‹ˆë‹¤.</p>

  <h3>RLS ë™ì‘ ì›ë¦¬</h3>
  <div class="diagram">
<pre>
ì„¼í„°ë§¤ë‹ˆì € A (ì„œì´ì²œ ì„¼í„°) ê°€ workers í…Œì´ë¸” ì¡°íšŒ ì‹œ:

SELECT * FROM workers;    â† ì „ì²´ ì¡°íšŒë¥¼ ìš”ì²­í•´ë„...

    â”‚ RLS ì •ì±… ìë™ ì ìš©
    â–¼

SELECT * FROM workers
WHERE site_id = get_my_site_id();    â† ìë™ìœ¼ë¡œ ì¡°ê±´ ì¶”ê°€!

ê²°ê³¼: ì„œì´ì²œ ì„¼í„° ê·¼ë¡œìë§Œ ë°˜í™˜ (ì•ˆì„±/ì˜ì™•/ë¶€í‰ ê·¼ë¡œìëŠ” ë³´ì´ì§€ ì•ŠìŒ)
</pre>
  </div>

  <h3>ì—­í• ë³„ ì ‘ê·¼ ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤</h3>
  <table>
    <tr><th>í…Œì´ë¸”</th><th>worker (ê·¼ë¡œì)</th><th>center_manager</th><th>owner / system_admin</th></tr>
    <tr>
      <td><strong>sites</strong></td>
      <td>ì „ì²´ ì¡°íšŒ</td>
      <td>ì „ì²´ ì¡°íšŒ</td>
      <td>ì „ì²´ CRUD</td>
    </tr>
    <tr>
      <td><strong>parts</strong></td>
      <td>ì „ì²´ ì¡°íšŒ</td>
      <td>ì „ì²´ ì¡°íšŒ</td>
      <td>ì „ì²´ CRUD</td>
    </tr>
    <tr>
      <td><strong>workers</strong></td>
      <td style="background:#e8f5e9;">ë³¸ì¸ë§Œ ì¡°íšŒ</td>
      <td style="background:#fff3e0;">ê°™ì€ ì„¼í„°ë§Œ</td>
      <td style="background:#e3f2fd;">ì „ì²´</td>
    </tr>
    <tr>
      <td><strong>attendances</strong></td>
      <td style="background:#e8f5e9;">ë³¸ì¸ë§Œ ì¡°íšŒ/ë“±ë¡</td>
      <td style="background:#fff3e0;">ê°™ì€ ì„¼í„°ë§Œ</td>
      <td style="background:#e3f2fd;">ì „ì²´</td>
    </tr>
    <tr>
      <td><strong>worker_profiles</strong></td>
      <td style="background:#e8f5e9;">ë³¸ì¸ë§Œ ì¡°íšŒ/ìˆ˜ì •</td>
      <td style="background:#fff3e0;">ê°™ì€ ì„¼í„°ë§Œ</td>
      <td style="background:#e3f2fd;">ì „ì²´</td>
    </tr>
    <tr>
      <td><strong>payrolls</strong></td>
      <td style="background:#e8f5e9;">ë³¸ì¸ë§Œ ì¡°íšŒ</td>
      <td style="background:#fff3e0;">ê°™ì€ ì„¼í„°ë§Œ</td>
      <td style="background:#e3f2fd;">ì „ì²´</td>
    </tr>
  </table>

  <h3>RLS í—¬í¼ í•¨ìˆ˜</h3>
  <div class="diagram">
<pre>
-- í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ role ì¡°íšŒ
CREATE FUNCTION get_my_role() RETURNS TEXT AS $$
  SELECT role FROM workers WHERE id = auth.uid()
$$ LANGUAGE sql SECURITY DEFINER;

-- í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ site_id ì¡°íšŒ
CREATE FUNCTION get_my_site_id() RETURNS UUID AS $$
  SELECT site_id FROM workers WHERE id = auth.uid()
$$ LANGUAGE sql SECURITY DEFINER;

-- RLS ì •ì±… ì˜ˆì‹œ: center_managerëŠ” ê°™ì€ ì„¼í„°ë§Œ ì¡°íšŒ
CREATE POLICY "center_manager_select" ON workers
  FOR SELECT USING (
    get_my_role() IN ('center_manager')
    AND site_id = get_my_site_id()
  );

-- RLS ì •ì±… ì˜ˆì‹œ: workerëŠ” ë³¸ì¸ë§Œ ì¡°íšŒ
CREATE POLICY "worker_select_own" ON workers
  FOR SELECT USING (
    get_my_role() = 'worker'
    AND id = auth.uid()
  );
</pre>
  </div>

  <div class="warn-box">
    <strong>ë³´ì•ˆ í•µì‹¬:</strong> í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œë¥¼ ì•„ë¬´ë¦¬ ìˆ˜ì •í•´ë„, DB ë ˆë²¨ì—ì„œ RLSê°€ ì°¨ë‹¨í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê·¼ë¡œìê°€ ë¸Œë¼ìš°ì € ê°œë°œìë„êµ¬ë¡œ APIë¥¼ ì§ì ‘ í˜¸ì¶œí•´ë„, JWTì˜ <code>auth.uid()</code>ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ëŠ” ì ˆëŒ€ ë°˜í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  </div>
</div>

<!-- ==================== 10. DEPLOYMENT ==================== -->
<div class="section" id="s10">
  <h2>10. ë°°í¬ êµ¬ì¡°</h2>

  <div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ë°°í¬ ì•„í‚¤í…ì²˜                                  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Manager Web (Flutter Web)        â”‚                          â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                          â”‚
â”‚  â”‚  flutter build web --release      â”‚                          â”‚
â”‚  â”‚  â†’ build/web/ (HTML/CSS/JS)       â”‚                          â”‚
â”‚  â”‚  â†’ Vercel / Netlify ë“±ì— ë°°í¬      â”‚                          â”‚
â”‚  â”‚  â†’ https://workflow.vercel.app    â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Worker App (Android)             â”‚                          â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                          â”‚
â”‚  â”‚  flutter build apk --release      â”‚                          â”‚
â”‚  â”‚  â†’ build/app/outputs/flutter.apk  â”‚                          â”‚
â”‚  â”‚  â†’ MVP: ì§ì ‘ ì„¤ì¹˜ (APK ì „ë‹¬)       â”‚                          â”‚
â”‚  â”‚  â†’ ì •ì‹: Google Play Store         â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Worker App (iOS)                 â”‚                          â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                          â”‚
â”‚  â”‚  flutter build ipa --release      â”‚                          â”‚
â”‚  â”‚  â†’ MVP: TestFlight               â”‚                          â”‚
â”‚  â”‚  â†’ ì •ì‹: App Store                â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Backend (Supabase Cloud)         â”‚  â† ì´ë¯¸ í´ë¼ìš°ë“œì—ì„œ ìš´ì˜ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                          â”‚
â”‚  â”‚  DB: ìë™ ìš´ì˜ (ë°±ì—…, ìŠ¤ì¼€ì¼ë§)     â”‚                          â”‚
â”‚  â”‚  Auth: ìë™ ìš´ì˜ (SMS, JWT)       â”‚                          â”‚
â”‚  â”‚  Edge Fn: MCPë¡œ ë°°í¬ ì™„ë£Œ          â”‚                          â”‚
â”‚  â”‚  â†’ ë³„ë„ ë°°í¬ ì‘ì—… ë¶ˆí•„ìš”!          â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                  â”‚
â”‚  í™˜ê²½ ë³€ìˆ˜ (.env):                                                â”‚
â”‚  SUPABASE_URL=https://xxxx.supabase.co                          â”‚
â”‚  SUPABASE_ANON_KEY=eyJhbG...                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
  </div>
</div>

<!-- ==================== 11. FILE REFERENCE ==================== -->
<div class="section" id="s11">
  <h2>11. íŒŒì¼ êµ¬ì¡° ë ˆí¼ëŸ°ìŠ¤</h2>

  <div class="diagram">
<pre>
attendance_go/
â”œâ”€â”€ pubspec.yaml                          # ë£¨íŠ¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ì˜
â”œâ”€â”€ .env                                  # í™˜ê²½ ë³€ìˆ˜ (SUPABASE_URL, KEY)
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ manager_web/                      # ê´€ë¦¬ì ì›¹ (Flutter Web)
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚       â”œâ”€â”€ main.dart                 # ì•± ì§„ì…ì , ë¼ìš°íŒ…, ManagerShell
â”‚   â”‚       â”œâ”€â”€ core/utils/
â”‚   â”‚       â”‚   â”œâ”€â”€ permissions.dart      # RBAC (AppRole, canAccessMenu)
â”‚   â”‚       â”‚   â”œâ”€â”€ company_constants.dart# íšŒì‚¬/ì„¼í„°/íŒŒíŠ¸ ìƒìˆ˜
â”‚   â”‚       â”‚   â””â”€â”€ employee_id_generator.dart
â”‚   â”‚       â””â”€â”€ features/
â”‚   â”‚           â”œâ”€â”€ auth/                 # ë¡œê·¸ì¸ (Email/PW)
â”‚   â”‚           â”‚   â”œâ”€â”€ data/auth_repository.dart
â”‚   â”‚           â”‚   â”œâ”€â”€ providers/auth_provider.dart
â”‚   â”‚           â”‚   â””â”€â”€ presentation/login_screen.dart
â”‚   â”‚           â”œâ”€â”€ dashboard/            # ëŒ€ì‹œë³´ë“œ
â”‚   â”‚           â”‚   â”œâ”€â”€ data/dashboard_repository.dart    â† Supabase ì¿¼ë¦¬
â”‚   â”‚           â”‚   â”œâ”€â”€ providers/dashboard_provider.dart
â”‚   â”‚           â”‚   â””â”€â”€ presentation/dashboard_screen.dart
â”‚   â”‚           â”œâ”€â”€ workers/              # ê·¼ë¡œì ê´€ë¦¬
â”‚   â”‚           â”‚   â”œâ”€â”€ data/workers_repository.dart      â† Supabase CRUD
â”‚   â”‚           â”‚   â””â”€â”€ presentation/workers_screen.dart
â”‚   â”‚           â”œâ”€â”€ attendance_records/   # ê·¼íƒœ ê¸°ë¡
â”‚   â”‚           â”œâ”€â”€ payroll/              # ê¸‰ì—¬ ê´€ë¦¬
â”‚   â”‚           â”‚   â”œâ”€â”€ data/payroll_repository.dart      â† ê¸‰ì—¬ ê³„ì‚°
â”‚   â”‚           â”‚   â””â”€â”€ presentation/payroll_screen.dart
â”‚   â”‚           â”œâ”€â”€ worker_detail/        # ê·¼ë¡œì ìƒì„¸
â”‚   â”‚           â”‚   â””â”€â”€ data/worker_detail_repository.dart
â”‚   â”‚           â”œâ”€â”€ settings/             # ì„¤ì •
â”‚   â”‚           â””â”€â”€ accounts/             # ê³„ì • ê´€ë¦¬
â”‚   â”‚
â”‚   â””â”€â”€ worker_app/                       # ê·¼ë¡œì ì•± (Android/iOS)
â”‚       â””â”€â”€ lib/
â”‚           â”œâ”€â”€ main.dart                 # ì•± ì§„ì…ì 
â”‚           â”œâ”€â”€ core/utils/
â”‚           â”‚   â””â”€â”€ phone_utils.dart      # E.164 ì „í™”ë²ˆí˜¸ ë³€í™˜
â”‚           â””â”€â”€ features/
â”‚               â”œâ”€â”€ auth/                 # ë¡œê·¸ì¸ (SMS OTP)
â”‚               â”‚   â”œâ”€â”€ data/auth_repository.dart        â† Supabase Auth
â”‚               â”‚   â”œâ”€â”€ providers/auth_provider.dart
â”‚               â”‚   â””â”€â”€ presentation/
â”‚               â”‚       â”œâ”€â”€ login_screen.dart
â”‚               â”‚       â”œâ”€â”€ phone_verification_screen.dart
â”‚               â”‚       â”œâ”€â”€ consent_screen.dart
â”‚               â”‚       â””â”€â”€ profile_completion_screen.dart
â”‚               â””â”€â”€ attendance/           # ì¶œí‡´ê·¼
â”‚                   â”œâ”€â”€ data/attendance_repository.dart   â† Supabase CRUD
â”‚                   â”œâ”€â”€ providers/attendance_provider.dart â† GPS + ìƒíƒœê´€ë¦¬
â”‚                   â””â”€â”€ presentation/
â”‚                       â”œâ”€â”€ home_screen.dart              â† ì¶œ/í‡´ê·¼ ë²„íŠ¼
â”‚                       â””â”€â”€ attendance_history_screen.dart
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                             # ê³µìœ  ë°ì´í„° ëª¨ë¸
â”‚   â”‚   â””â”€â”€ lib/src/models/
â”‚   â”‚       â”œâ”€â”€ worker.dart               # Worker (Freezed)
â”‚   â”‚       â”œâ”€â”€ worker_profile.dart       # WorkerProfile (Freezed)
â”‚   â”‚       â”œâ”€â”€ attendance.dart           # Attendance (Freezed)
â”‚   â”‚       â””â”€â”€ payroll.dart              # Payroll (Freezed)
â”‚   â”‚
â”‚   â”œâ”€â”€ supabase_client/                  # Supabase ì—°ê²° ë ˆì´ì–´
â”‚   â”‚   â””â”€â”€ lib/src/
â”‚   â”‚       â”œâ”€â”€ supabase_service.dart     # ì‹±ê¸€í†¤ (ì´ˆê¸°í™”, ì¿¼ë¦¬, Auth)
â”‚   â”‚       â”œâ”€â”€ providers.dart            # Riverpod í”„ë¡œë°”ì´ë”
â”‚   â”‚       â””â”€â”€ exceptions.dart           # ì»¤ìŠ¤í…€ ì˜ˆì™¸
â”‚   â”‚
â”‚   â””â”€â”€ ui_components/                    # ê³µìœ  UI ìœ„ì ¯
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/                       # DB ìŠ¤í‚¤ë§ˆ (SQL)
â”‚   â”‚   â”œâ”€â”€ 001_initial_schema.sql        # í…Œì´ë¸”, ì¸ë±ìŠ¤
â”‚   â”‚   â”œâ”€â”€ 002_rls_policies.sql          # RLS ë³´ì•ˆ ì •ì±…
â”‚   â”‚   â”œâ”€â”€ 003_triggers.sql              # work_hours ìë™ê³„ì‚°
â”‚   â”‚   â”œâ”€â”€ 004_payroll_table.sql         # ê¸‰ì—¬ í…Œì´ë¸”
â”‚   â”‚   â””â”€â”€ 011_add_bank_fields...sql     # bank í•„ë“œ ì¶”ê°€
â”‚   â”‚
â”‚   â””â”€â”€ functions/
â”‚       â””â”€â”€ calculate-payroll/            # Edge Function (Deno/TS)
â”‚           â””â”€â”€ index.ts                  # ê¸‰ì—¬ ê³„ì‚° ë¡œì§
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ architecture_frontend_backend_communication.html  â† ì´ ë¬¸ì„œ!
    â””â”€â”€ workflow_managerUI_CLI/            # ë²„ì „ë³„ ì‘ì—… ë‚´ì—­
</pre>
  </div>
</div>

<!-- ==================== FOOTER ==================== -->
<div style="text-align:center; padding: 32px 0; color: #999; font-size: 12px; border-top: 1px solid #eee; margin-top: 40px;">
  <p><strong>WorkFlow by tkholdings</strong> | System Architecture Document v1.17</p>
  <p>Generated: 2026-02-12 | attendance_go (ì¶œí‡´ê·¼GO)</p>
</div>

</body>
</html>
