# v1.20: 카카오/구글 OAuth 실제 연동 + GPS 강화 + 주소 검색 API

## 작업일: 2026-02-14

## 변경 요약

### 1. 카카오/구글 OAuth 실제 연동
- 데모 코드 제거 → Supabase `signInWithOAuth` 실제 호출
- **카카오**: `OAuthProvider.kakao` + 브라우저 기반 OAuth
- **구글**: `OAuthProvider.google` + 브라우저 기반 OAuth
- OAuth 완료 후 전화번호 매칭 플로우:
  1. OAuth 로그인 → 브라우저로 이동
  2. 인증 완료 → 딥링크로 앱 복귀
  3. `onAuthStateChange` → 세션 복원
  4. worker 매칭 실패 → 전화번호 입력 화면
  5. 관리자가 등록한 전화번호 입력 → worker 매칭 → 인증 완료
- 딥링크 설정: `io.supabase.workflowapp://login-callback`
  - Android: `AndroidManifest.xml` intent-filter 추가
  - iOS: `Info.plist` CFBundleURLSchemes 추가
- `auth_provider.dart`: `_setupAuthListener()` — OAuth 딥링크 콜백 수신
- `restoreSession()`: OAuth 세션 감지 → `needsPhoneVerification` 분기
- `PhoneVerificationScreen`: OTP 제거 → 전화번호 입력만으로 매칭

### 2. Worker App GPS 출퇴근 실기기 대응 강화
- GPS 위치 수신 **15초 타임아웃** 추가 (`LocationSettings.timeLimit`)
- `TimeoutException` 전용 에러 메시지: "GPS 신호를 받지 못했습니다"
- GPS 정확도 검증: 500m 초과 시 경고 → 재시도 안내
- 위치 서비스/권한 확인 시 catch 블록 추가 (크래시 방지)
- 퇴근 실패 시 `checkedIn` 상태로 복원 (기존: error 상태로 변경됨)
- `_friendlyError()` 헬퍼: 네트워크/서버/GPS 에러 → 사용자 친화적 메시지

### 3. 주소 검색 API 실제 연동 (juso.go.kr)
- mock 주소 데이터 완전 제거
- **행정안전부 도로명주소 API** (juso.go.kr) 연동
  - `JUSO_CONFIRM_KEY` 환경변수 (.env)
  - 도로명주소, 지번주소, 우편번호 표시
  - 비동기 검색 + 로딩 표시
  - API 키 미설정 시 안내 메시지
- `core/services/address_service.dart` 신규 생성
- `http: ^1.2.1` 패키지 추가
- 검색 결과: 도로명주소 (메인) + [우편번호] 지번주소 (서브)

## 신규/수정 파일

### 신규 (1개)
```
apps/worker_app/lib/core/services/address_service.dart
```

### 수정 (8개)
```
apps/worker_app/pubspec.yaml                              — url_launcher, http 추가
apps/worker_app/android/app/src/main/AndroidManifest.xml  — OAuth 딥링크 intent-filter
apps/worker_app/ios/Runner/Info.plist                      — OAuth URL scheme
apps/worker_app/lib/features/auth/data/auth_repository.dart      — 실제 OAuth + phone matching
apps/worker_app/lib/features/auth/providers/auth_provider.dart   — OAuth 플로우 + auth listener
apps/worker_app/lib/features/auth/presentation/phone_verification_screen.dart — 전화번호 매칭 UI
apps/worker_app/lib/features/auth/presentation/profile_completion_screen.dart — 주소 API 연동
apps/worker_app/lib/features/attendance/providers/attendance_provider.dart    — GPS 타임아웃/에러
```

## 환경 설정 필요사항

### Supabase Dashboard
1. Authentication > Providers > **Kakao** 활성화
   - Kakao Developers 콘솔에서 REST API Key + Client Secret 입력
   - Redirect URI: `https://<project-ref>.supabase.co/auth/v1/callback`
2. Authentication > Providers > **Google** 활성화
   - Google Cloud Console에서 OAuth Client ID/Secret 입력
3. Authentication > URL Configuration > Redirect URLs:
   - `io.supabase.workflowapp://login-callback` 추가

### .env 파일
```
SUPABASE_URL=...
SUPABASE_ANON_KEY=...
JUSO_CONFIRM_KEY=...   # juso.go.kr에서 발급 (무료)
```

## 검증
- `flutter analyze` — 에러 0, warning 1 (기존 unused variable)
- `flutter build web` — 빌드 성공
