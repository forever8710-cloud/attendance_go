# v1.28: Worker App 코드 리뷰 수정 + GPS 사업장 검증 + 좌표 업데이트

## 작업 일자
2026-02-21

## 변경 사항

### 1. 데모 로그인 버튼 릴리스 빌드 숨김 (#1+#2)
- **파일**: `apps/worker_app/lib/features/auth/presentation/login_screen.dart`
- `kDebugMode`로 감싸서 릴리스 APK에서는 데모 로그인 버튼 노출되지 않음
- `import 'package:flutter/foundation.dart' show kDebugMode;` 추가

### 2. saveProfile() Null Safety 추가 (#3)
- **파일**: `apps/worker_app/lib/features/auth/providers/auth_provider.dart`
- `state.worker == null` 체크 추가 → 에러 메시지 표시 후 조기 리턴
- 기존에는 null일 때 `!` 연산자로 크래시 가능성

### 3. Android 패키지명 변경 (#4)
- **파일**: `apps/worker_app/android/app/build.gradle.kts`
- `com.example.worker_app` → `com.tkholdings.workflow`
- MainActivity.kt 파일도 새 패키지 경로로 이동

### 4. GPS 사업장 반경 검증 (#5)
- **파일**: `apps/worker_app/lib/features/attendance/data/attendance_repository.dart`
  - `getWorkerSite(workerId)` 메서드 추가 — workers → sites 조인 조회
- **파일**: `apps/worker_app/lib/features/attendance/providers/attendance_provider.dart`
  - `_validateSiteProximity()` — Haversine 공식으로 GPS 거리 계산
  - `_haversineDistance()`, `_toRadians()` 헬퍼 함수
  - checkIn, checkOut, earlyLeave에서 GPS 위치 획득 후 사업장 반경 검증

### 5. Supabase sites 테이블 좌표 업데이트
| 센터 | 위도 | 경도 | 반경 | 비고 |
|------|------|------|------|------|
| 서이천센터 | 37.283039 | 127.389601 | 300m | 기존 50km→300m 수정 |
| 의왕센터 | 37.33097 | 126.95540 | 100m | 좌표 정확도 개선 |
| 안성센터 | 37.008 | 127.2797 | 100m | 변경 없음 |
| 부평센터 | 37.5074 | 126.7218 | 100m | 변경 없음 |

## 수정 파일 목록
- `apps/worker_app/android/app/build.gradle.kts`
- `apps/worker_app/android/app/src/main/kotlin/com/tkholdings/workflow/MainActivity.kt` (이동)
- `apps/worker_app/lib/features/attendance/data/attendance_repository.dart`
- `apps/worker_app/lib/features/attendance/providers/attendance_provider.dart`
- `apps/worker_app/lib/features/auth/presentation/login_screen.dart`
- `apps/worker_app/lib/features/auth/providers/auth_provider.dart`

### 6. 계정관리 로그인 아이디(이메일) 표시 버그 수정
- **파일**: `apps/manager_web/lib/features/accounts/providers/accounts_provider.dart`
- `worker_profiles`에 UNIQUE 제약 → Supabase PostgREST가 배열 대신 단일 객체 반환
- 기존 코드: `List`만 체크 → 항상 null → "-" 표시
- 수정: `Map`(객체)과 `List`(배열) 모두 처리하도록 분기 추가
- 수정 후 모든 관리자의 로그인 아이디(이메일) 정상 표시 확인

### 7. 계정 생성 플로우 테스트
- 테스트 계정 생성: `test@taekyung.com` / `test1234` / 센터장 / 서이천센터
- Auth 유저 + workers + worker_profiles 동시 생성 검증 완료
- Edge Function `create-auth-user` ACTIVE 상태 확인

## 전체 관리자 계정 현황
| 이름 | 이메일 | 권한 | 비고 |
|------|--------|------|------|
| 김지훈 | kim@taekyung.com | 시스템관리자 | 개발자 |
| 승근수 | seung@taekyung.com | 대표이사 | 태경홀딩스 |
| 황일순 | hwang@botrens.com | 대표이사 | 보트랜스 |
| 진명호 | jin@botrens.com | 센터장 | |
| 함경식 | ham@botrens.com | 센터장 | |
| 테스트관리자 | test@taekyung.com | 센터장 | 테스트용 |
