# v1.28: Worker App 코드 리뷰 수정 + GPS 사업장 검증 + 좌표 업데이트

## 작업 일자
2026-02-21

## 변경 사항

### 1. 데모 로그인 버튼 릴리스 빌드 숨김 (#1+#2)
- **파일**: `apps/worker_app/lib/features/auth/presentation/login_screen.dart`
- `kDebugMode`로 감싸서 릴리스 APK에서는 데모 로그인 버튼 노출되지 않음
- `import 'package:flutter/foundation.dart' show kDebugMode;` 추가

### 2. saveProfile() Null Safety 추가 (#3)
- **파일**: `apps/worker_app/lib/features/auth/providers/auth_provider.dart`
- `state.worker == null` 체크 추가 → 에러 메시지 표시 후 조기 리턴
- 기존에는 null일 때 `!` 연산자로 크래시 가능성

### 3. Android 패키지명 변경 (#4)
- **파일**: `apps/worker_app/android/app/build.gradle.kts`
- `com.example.worker_app` → `com.tkholdings.workflow`
- MainActivity.kt 파일도 새 패키지 경로로 이동

### 4. GPS 사업장 반경 검증 (#5)
- **파일**: `apps/worker_app/lib/features/attendance/data/attendance_repository.dart`
  - `getWorkerSite(workerId)` 메서드 추가 — workers → sites 조인 조회
- **파일**: `apps/worker_app/lib/features/attendance/providers/attendance_provider.dart`
  - `_validateSiteProximity()` — Haversine 공식으로 GPS 거리 계산
  - `_haversineDistance()`, `_toRadians()` 헬퍼 함수
  - checkIn, checkOut, earlyLeave에서 GPS 위치 획득 후 사업장 반경 검증

### 5. Supabase sites 테이블 좌표 업데이트
| 센터 | 위도 | 경도 | 반경 | 비고 |
|------|------|------|------|------|
| 서이천센터 | 37.283039 | 127.389601 | 300m | 기존 50km→300m 수정 |
| 의왕센터 | 37.33097 | 126.95540 | 100m | 좌표 정확도 개선 |
| 안성센터 | 37.008 | 127.2797 | 100m | 변경 없음 |
| 부평센터 | 37.5074 | 126.7218 | 100m | 변경 없음 |

## 수정 파일 목록
- `apps/worker_app/android/app/build.gradle.kts`
- `apps/worker_app/android/app/src/main/kotlin/com/tkholdings/workflow/MainActivity.kt` (이동)
- `apps/worker_app/lib/features/attendance/data/attendance_repository.dart`
- `apps/worker_app/lib/features/attendance/providers/attendance_provider.dart`
- `apps/worker_app/lib/features/auth/presentation/login_screen.dart`
- `apps/worker_app/lib/features/auth/providers/auth_provider.dart`
