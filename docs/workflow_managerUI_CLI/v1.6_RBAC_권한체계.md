# v1.6 — RBAC 권한 체계 구현

## 변경 요약
4가지 역할(시스템관리자, 대표이사, 센터장, 근로자) 기반의 RBAC 권한 체계를 구현하였습니다.

## 역할 정의

| 역할 | 코드 | 범위 |
|------|------|------|
| 시스템관리자 | `system_admin` | 전체 (태경홀딩스) |
| 대표이사 | `owner` | 전체 (보트랜스 대표) |
| 센터장 | `center_manager` | 해당 센터 |
| 근로자 | `worker` | 본인 (관리자웹 접근 불가) |

## 메뉴별 접근 권한

| 메뉴 | system_admin | owner | center_manager |
|:---|:---:|:---:|:---:|
| 홈 | O | O | O |
| 근로자 관리 | O | O | O (본인센터) |
| 근태 기록 | O | O | O (본인센터) |
| 급여 관리 | O | O | 조회만 |
| 설정 | O | X | X |
| 계정 관리 | O | O | X |

## 변경 파일

### 신규 파일
- `lib/core/utils/permissions.dart` — AppRole enum + 권한 헬퍼 함수
- `supabase/migrations/005_extend_roles.sql` — DB role 제약 확장

### 수정 파일
- `lib/features/auth/providers/auth_provider.dart` — AppRole 기반 인증, demoLogin(role) 파라미터
- `lib/features/auth/presentation/login_screen.dart` — 데모 로그인 역할 선택 드롭다운
- `lib/core/widgets/side_nav_drawer.dart` — 역할 기반 메뉴 필터링 (railIndex ↔ menuIndex 변환)
- `lib/main.dart` — 역할 전달, 접근 제어, 헤더에 역할 배지 표시
- `lib/features/workers/presentation/workers_screen.dart` — center_manager 센터 필터링, 편집 권한 제어
- `lib/features/payroll/presentation/payroll_screen.dart` — center_manager 조회만 (엑셀/확정 버튼 숨김)
- `lib/features/accounts/presentation/accounts_screen.dart` — 새 역할 드롭다운, 역할 배지 업데이트

## 핵심 설계
- `permissions.dart`의 `canAccessMenu(role, menuIndex)` 함수로 권한 체크 중앙화
- SideNavDrawer에서 접근 불가 메뉴를 리스트에서 제거 (railIndex ↔ menuIndex 변환 처리)
- `_buildPage()`에서 이중 방어 (접근 불가 시 홈으로 리다이렉트)
- 기존 `manager` role은 하위호환으로 `system_admin`에 매핑
