# v1.9 — 인증 전략 및 주소 API 문서 업데이트

**작업일:** 2026-02-08
**범위:** `docs/workflow_proposal_md/` 4개 문서 전체 (v1.2 → v1.3)

---

## 배경

기존 근로자 인증은 SMS OTP 단일 방식이었으나, 사용자 편의성과 외국인 근로자 대응을 위해 SNS 로그인을 도입. 또한 근로자 추가정보 입력 시 주소 자동검색 기능을 위해 도로명주소 API 연동 결정.

## 인증 전략

| 방식 | 대상 | 전화번호 수집 | 비고 |
|------|------|-------------|------|
| 카카오 로그인 (Primary) | 대부분 한국인 근로자 | 비즈앱 → 자동 수집 | 가장 많은 사용자 커버 |
| 구글 로그인 (Secondary) | 외국인 근로자, 카카오 미사용자 | 수동 입력 + SMS OTP | 전화번호 별도 인증 필요 |
| SMS OTP (Fallback) | SNS 계정 없는 근로자 | 직접 입력 | 기존 방식 유지 |

## 근로자 회원가입 플로우

```
1. 관리자가 근로자 기본정보 등록 (이름, 연락처, 소속센터, 파트)
      ↓
2. 근로자 앱 설치 → 로그인 방식 선택
      ↓
3-A. 카카오 로그인 → 전화번호 자동 매칭
3-B. 구글 로그인 → 전화번호 수동 입력 + SMS OTP → 매칭
3-C. SMS OTP → 전화번호 매칭
      ↓
4. 추가정보 입력 폼 (최초 1회)
   - 주민등록번호/외국인등록번호
   - 주소 (도로명주소 API 자동검색)
   - 계좌정보
      ↓
5. 법적 동의 화면
      ↓
6. 메인 화면 진입
```

## 주소 검색 API

- **행정안전부 도로명주소 API** (juso.go.kr)
- 비용: 무료 (일 10만건)
- 연동: Supabase Edge Function Proxy (API 키 서버 측 관리)
- UX: 동/도로명 입력 → debounce 300ms → 실시간 자동완성

---

## 변경 파일 및 상세 내역

### 1. 01_PRD_WorkFlow.md (v1.2 → v1.3)

- **6.1.1 인증 및 사용자 관리:**
  - 근로자 계정 생성: 관리자가 기본정보만 등록
  - 근로자 로그인: 카카오(Primary) / 구글(Secondary) / SMS(Fallback)
  - 추가정보 입력: 주민번호, 주소(도로명주소 API), 계좌정보
- **6.1.5 근로자 관리:** 관리자는 기본정보만, 추가정보는 근로자 직접 입력

### 2. 02_TRD_WorkFlow.md (v1.2 → v1.3)

- **3.1.3 주요 패키지:** kakao_flutter_sdk, google_sign_in 추가
- **3.3 External APIs:** 카카오 로그인/비즈앱, 구글 Sign-In, 도로명주소, 카카오 로컬 API 추가
- **4.2.3 workers 스키마:** SNS 필드(auth_provider, auth_provider_id, email, profile_image_url), 추가정보 필드(resident_number, address, address_detail, bank_name, bank_account, is_profile_complete) 추가
- **5.1 인증 API:** 7개 API로 확장
  - 5.1.1 카카오 로그인
  - 5.1.2 구글 로그인
  - 5.1.3 전화번호 인증 (구글 후 추가)
  - 5.1.4 SMS OTP (Fallback)
  - 5.1.5 추가정보 입력
  - 5.1.6 도로명주소 검색 (Proxy)
  - 5.1.7 관리자 로그인

### 3. 03_UserFlow_WorkFlow.md (v1.2 → v1.3)

- **2.1 회원가입 및 로그인:** 전체 리뉴얼
  - 로그인 방식 선택 화면 (카카오/구글/SMS)
  - 카카오: SDK → 비즈앱 전화번호 → 매칭
  - 구글: Sign-In → 전화번호 수동 + OTP → 매칭
  - SMS: 기존 방식
  - 추가정보 입력 폼 (주민번호, 주소 API, 계좌)
  - 법적 동의 → 메인 화면
- **화면 전환 매트릭스:** 로그인 방식 선택, SNS 인증, 추가정보 입력 행 추가
- **에러 메시지:** KAKAO_LOGIN_FAILED, GOOGLE_LOGIN_FAILED, PHONE_NOT_REGISTERED, PROFILE_INCOMPLETE, ADDRESS_SEARCH_FAILED 추가

### 4. 04_PromptDesign_WorkFlow.md (v1.2 → v1.3)

- **Milestone 2 (Supabase):** address-search Edge Function (도로명주소 API Proxy) 추가
- **Milestone 3 (DB 스키마):** workers에 auth_provider, 주소/계좌/프로필 필드 추가
- **Milestone 4 (모델):** Worker에 authProvider, address, bankAccount 등 필드, AuthProvider enum 추가
- **Milestone 5 (근로자 인증):** 전체 리뉴얼
  - 카카오/구글/SMS 3가지 인증 Repository
  - 로그인 방식 선택 화면
  - 전화번호 인증 화면 (구글 후)
  - 추가정보 입력 화면 (주소 API 연동)
  - 주소 검색 위젯 (debounce + 자동완성)
  - 산출물 7개 파일

---

## 기술 참고

### 카카오 비즈앱 설정 (전화번호 수집)
1. Kakao Developers → 앱 등록
2. 비즈앱 전환 (사업자등록증 필요)
3. 동의항목 → "전화번호" 활성화
4. 사용자 동의 시 자동 수집

### 행정안전부 도로명주소 API
- 신청: juso.go.kr → API 신청
- 인증키 발급: 즉시 (무료)
- 호출: `https://business.juso.go.kr/addrlink/addrLinkApi.do`
- 파라미터: `keyword` (검색어), `resultType=json`
